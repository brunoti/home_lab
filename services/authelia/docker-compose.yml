services:
  authelia:
    image: authelia/authelia:latest
    container_name: authelia
    restart: unless-stopped
    # Load environment variables from root .env file
    # Relative path used because docker compose is run from service directory via justfile
    env_file:
      - ../../.env
    environment:
      - TZ=UTC
      - AUTHELIA_JWT_SECRET=${AUTHELIA_JWT_SECRET:-change_me}
      - AUTHELIA_SESSION_SECRET=${AUTHELIA_SESSION_SECRET:-change_me}
      - AUTHELIA_STORAGE_POSTGRES_HOST=postgres
      - AUTHELIA_STORAGE_POSTGRES_PORT=5432
      - AUTHELIA_STORAGE_POSTGRES_DATABASE=authelia
      - AUTHELIA_STORAGE_POSTGRES_USERNAME=postgres
      - AUTHELIA_STORAGE_POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
    volumes:
      - ../../config/authelia:/config
    ports:
      - "9091:9091"
    depends_on:
      - postgres
    networks:
      - homelab
  
networks:
  homelab:
    external: true
    name: homelab
