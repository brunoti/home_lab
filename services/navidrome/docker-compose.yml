services:
  navidrome:
    image: deluan/navidrome:latest
    container_name: navidrome
    restart: unless-stopped
    # Load environment variables from root .env file
    # Relative path used because docker compose is run from service directory via justfile
    env_file:
      - ../../.env
    environment:
      - ND_MUSICFOLDER=${NAVIDROME_MUSIC_FOLDER:-/music}
      - ND_DATAFOLDER=${NAVIDROME_DATA_FOLDER:-/data}
      - ND_SCANINTERVAL=${NAVIDROME_SCAN_INTERVAL:-1m}
      - ND_BASEURL=${NAVIDROME_BASEURL:-http://localhost:4533}
    volumes:
      - ../../data/navidrome:/data
      - ../../data/koel/music:/music:ro
    ports:
      - "4533:4533"
    networks:
      - homelab
  
networks:
  homelab:
    external: true
    name: homelab
